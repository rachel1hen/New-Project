name: Bark Test

on:
  workflow_dispatch:

jobs:
  bark-run:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repo
      uses: actions/checkout@v3
    
    - name: Show available disk space
      run: df -h

  
    - name: Free up disk space
      run: |
        sudo apt-get clean
        sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc \
          /usr/local/share/boost /usr/local/share/chromium /usr/share/swift \
          /usr/local/graalvm /opt/hostedtoolcache/CodeQL
        docker system prune -af || true
        sudo rm -rf /var/lib/mysql /var/lib/postgresql
        sudo rm -rf /tmp/*
        sudo rm -rf $HOME/.cargo
        sudo rm -rf $HOME/.gem
        sudo rm -rf $HOME/.rustup
        sudo rm -rf $HOME/.nvm
        sudo rm -rf $HOME/.npm
        sudo rm -rf $HOME/.gradle
        sudo rm -rf $HOME/.cache
        sudo rm -rf /home/runner/.cache
        
    - name: Remove Cache
      run: |
          rm -rf /home/runner/.cache/huggingface/*
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Show available disk space
      run: df -h
  
    # - name: Cache pip dependencies
    #   uses: actions/cache@v3
    #   with:
    #     path: ~/.cache/pip
    #     key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
    #     restore-keys: |
    #       ${{ runner.os }}-pip-

    - name: Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run Bark Test Script
      run: python test_bark.py

    - name: Upload Audio Artifact
      uses: actions/upload-artifact@v4
      with:
        name: bark-audio
        path: *.wav
